<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الملف الأكاديمي</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --glass: rgba(255, 255, 255, 0.9); --primary: #4361ee; --danger: #ef233c; --success: #2ec4b6; }
        body { background: #f0f4f8; font-family: 'Segoe UI', Roboto, sans-serif; color: #2b2d42; padding-bottom: 100px; }
        .main-card { background: var(--glass); border-radius: 30px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.05); overflow: hidden; }
        .header-gradient { background: linear-gradient(135deg, #4361ee, #4cc9f0); padding: 40px 20px; color: white; border-radius: 0 0 50px 50px; text-align: center; }
        .info-pill { background: rgba(255,255,255,0.2); border-radius: 50px; padding: 5px 15px; font-size: 0.85rem; backdrop-filter: blur(5px); }
        .action-card { border-radius: 25px; border: 2px solid #edf2f7; background: white; transition: all 0.3s ease; }
        .attendance-row { border-radius: 20px; background: white; margin-bottom: 12px; transition: transform 0.2s; border-right: 5px solid var(--primary); }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-left: 8px; }
        .btn-round { border-radius: 50px; padding: 10px 25px; font-weight: 600; }
        .bottom-nav { position: fixed; bottom: 20px; left: 20px; right: 20px; background: rgba(43, 45, 66, 0.95); backdrop-filter: blur(10px); border-radius: 30px; display: flex; justify-content: space-around; padding: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); z-index: 2000; }
        .nav-link { color: #8d99ae; text-decoration: none; font-size: 1.2rem; }
        .nav-link.active { color: #4cc9f0; }
    </style>
</head>
<body>

<div class="header-gradient mb-4">
    <div class="container">
        <div class="mb-3">
            <i class="fas fa-user-circle fa-5x"></i>
        </div>
        <h2 class="fw-bold mb-1"><%= student.firstName %> <%= student.lastName %></h2>
        <div class="d-flex justify-content-center gap-2 mt-3">
            <span class="info-pill"><i class="fas fa-graduation-cap"></i> <%= student.year %></span>
            <span class="info-pill"><i class="fas fa-microscope"></i> <%= student.stream %></span>
        </div>
    </div>
</div>

<div class="container">
    <div class="main-card p-4 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="fw-bold m-0"><i class="fas fa-wallet text-primary me-2"></i> الوضع المالي</h5>
            <span class="badge rounded-pill p-2 px-3 <%= student.paymentStatus === 'تم الدفع' ? 'bg-success-subtle text-success' : 'bg-danger-subtle text-danger' %>">
                <i class="fas <%= student.paymentStatus === 'تم الدفع' ? 'fa-check-double' : 'fa-exclamation-triangle' %> me-1"></i>
                <%= student.paymentStatus %>
            </span>
        </div>
        
        <form action="/update-student/<%= student.id %>" method="POST" class="d-flex gap-2">
            <select name="paymentStatus" class="form-select border-0 bg-light rounded-pill px-4">
                <option value="لم يتم الدفع" <%= student.paymentStatus === 'لم يتم الدفع' ? 'selected' : '' %>>تعيين كـ "غير مدفوع"</option>
                <option value="تم الدفع" <%= student.paymentStatus === 'تم الدفع' ? 'selected' : '' %>>تعيين كـ "تم الدفع"</option>
            </select>
            <button class="btn btn-primary btn-round shadow-sm"><i class="fas fa-save"></i></button>
        </form>
    </div>

    <div class="main-card p-4">
        <h5 class="fw-bold mb-4"><i class="fas fa-calendar-check text-primary me-2"></i> سجل الحصص</h5>
        
        <form action="/update-student/<%= student.id %>" method="POST" class="mb-4">
            <div class="input-group p-1 bg-light rounded-pill">
                <input type="date" name="attendanceDate" class="form-control border-0 bg-transparent px-4" required>
                <button class="btn btn-primary btn-round" type="submit">تسجيل حصة</button>
            </div>
        </form>

        <div class="attendance-container">
            <% if(student.attendance && student.attendance.length > 0) { %>
                <% student.attendance.reverse().forEach(record => { %>
                    <div class="attendance-row p-3 shadow-sm d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="status-dot bg-success"></div>
                            <span class="fw-semibold">حصة يوم: <%= record.date %></span>
                        </div>
                        <i class="fas fa-check-circle text-success"></i>
                    </div>
                <% }) %>
            <% } else { %>
                <div class="text-center py-4">
                    <i class="fas fa-folder-open fa-3x text-light mb-2"></i>
                    <p class="text-muted small">لا يوجد نشاط مسجل</p>
                </div>
            <% } %>
        </div>
    </div>

    <div class="text-center mt-5">
        <a href="/delete/<%= student.id %>" class="text-danger text-decoration-none small fw-bold" onclick="return confirm('حذف نهائي؟')">
            <i class="fas fa-user-times"></i> حذف ملف الطالب
        </a>
    </div>
</div>

<div class="bottom-nav">
    <a href="/" class="nav-link"><i class="fas fa-th-large"></i></a>
    <a href="/stats" class="nav-link"><i class="fas fa-chart-line"></i></a>
</div>

</body>
</html>
